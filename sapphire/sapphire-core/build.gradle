apply plugin: 'java'

repositories {
    flatDir {
        dirs '../libs'
    }
}

dependencies {
    compile fileTree(include: ['*.jar'], dir: 'libs')
    compile 'org.json:json:20171018'
    compile name: 'java.rmi'
    compile name: 'apache.harmony'
    testCompile 'junit:junit:4.12'
    testCompile 'org.mockito:mockito-core:1.+'
}

task deleteJar(type: Delete) {
    delete 'libs/sapphire-core.jar'
}

// run `gradle delstubs` to remove stub java files
task delstubs(type: Delete) {
    delete fileTree('src/main/java/sapphire/policy/stubs') {
        include '**/*_Stub.java'
    }
}

// TODO: We could use gradle to do automatic incremental builds.  
// Details can be found at https://blog.gradle.org/introducing-incremental-build-support
task genstubs(type: Exec) {
  dependsOn 'delstubs', 'build'
  executable "bash"
  args "-c", "pushd ../../generators && python generate_policy_stubs_on_host.py && popd"
}

task createJar(type: Copy) {
    from('build/intermediates/bundles/release/')
    into('libs/jars/')
    include('classes.jar')
    rename('classes.jar', 'sapphire-core.jar')
}

createJar.dependsOn(deleteJar, build)

sourceCompatibility = "1.6"
targetCompatibility = "1.6"
